{% extends "base_subpage.html" %}
{% load static i18n i18n_fields %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/news.css' %}">
{% endblock %}

{% block title %}{% trans "Press Releases" %} - TIU{% endblock %}

{% block content %}
{% include "includes/page_hero.html" %}

<section class="evlist-section">
    <div class="container">
        <div class="evlist-layout">
            <!-- Left sidebar — sticky filters -->
            <aside class="evlist-sidebar">
                <div class="evlist-sidebar-inner">
                    <div class="evlist-filters-heading">
                        <i class="fas fa-sliders-h"></i>
                        <span>{% trans "Filters" %}</span>
                    </div>

                    <div class="evlist-filter-group">
                        <label class="evlist-filter-label">{% trans "Search" %}</label>
                        <div class="evlist-search-wrapper">
                            <input type="text" id="press-search" class="evlist-search-input" placeholder="{% trans "Search press releases..." %}" value="{{ search_query }}" onkeydown="if(event.key==='Enter')applyPressFilters()">
                            <button class="evlist-search-btn" onclick="applyPressFilters()"><i class="fas fa-search"></i></button>
                        </div>
                    </div>

                    <div class="evlist-filter-group">
                        <label class="evlist-filter-label">{% trans "Category" %}</label>
                        <div class="evlist-select-wrapper">
                            <select id="press-category" class="evlist-select" onchange="applyPressFilters()">
                                <option value="">{% trans "All categories" %}</option>
                                {% for value, label in categories %}
                                <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                            <i class="fas fa-chevron-down evlist-select-icon"></i>
                        </div>
                    </div>

                    <div class="evlist-filter-group">
                        <button class="evlist-clear-btn" onclick="clearPressFilters()">
                            <i class="fas fa-times"></i> {% trans "Clear filters" %}
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Right side — press release list -->
            <div class="evlist-content">
                {% for release in releases %}
                <article class="evlist-item">
                    <a href="{% url 'news:press_detail' release.slug %}" class="evlist-item-link">
                        <div class="evlist-item-thumb">
                            {% if release.featured_image %}
                            <img src="{{ release.featured_image.url }}" alt="{{ release|trans_field:"title" }}" loading="lazy">
                            {% else %}
                            <img src="{% static 'img/campus/b1.jpg' %}" alt="{{ release|trans_field:"title" }}" loading="lazy">
                            {% endif %}
                        </div>
                        <div class="evlist-item-info">
                            <h3 class="evlist-item-title">{{ release|trans_field:"title" }}</h3>
                            <span class="evlist-item-date">{{ release.published_date|date:"d M Y"|upper }}</span>
                            {% if release.excerpt %}
                            <p class="evlist-item-desc">{{ release|trans_field:"excerpt"|truncatewords:25 }}</p>
                            {% endif %}
                        </div>
                    </a>
                </article>
                {% empty %}
                <div class="evlist-empty">
                    <i class="far fa-newspaper"></i>
                    <h3>{% trans "No press releases found" %}</h3>
                    <p>{% trans "Try adjusting your search or clearing filters to see all press releases." %}</p>
                </div>
                {% endfor %}

                {% if releases.has_other_pages %}
                <div class="pagination">
                    {% if releases.has_previous %}
                    <a href="?page={{ releases.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="pagination-btn">&laquo; {% trans "Previous" %}</a>
                    {% endif %}
                    {% for num in releases.paginator.page_range %}
                    <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="pagination-btn{% if releases.number == num %} active{% endif %}">{{ num }}</a>
                    {% endfor %}
                    {% if releases.has_next %}
                    <a href="?page={{ releases.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="pagination-btn">{% trans "Next" %} &raquo;</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Explore More -->
<section class="explore-more-section">
    <div class="container">
        <div class="explore-more-label">{% trans "EXPLORE MORE" %}</div>
        <div class="explore-more-links">
            <a href="{% url 'news:news_list' %}" class="explore-more-link">{% trans "Latest News" %} <i class="fas fa-arrow-right"></i></a>
            <a href="{% url 'news:event_list' %}" class="explore-more-link">{% trans "Events" %} <i class="fas fa-arrow-right"></i></a>
            <a href="{% url 'news:press_releases' %}" class="explore-more-link">{% trans "Press Releases" %} <i class="fas fa-arrow-right"></i></a>
            <a href="{% url 'news:gallery' %}" class="explore-more-link">{% trans "Gallery" %} <i class="fas fa-arrow-right"></i></a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function applyPressFilters() {
    var q = document.getElementById('press-search').value.trim();
    var cat = document.getElementById('press-category').value;
    var params = new URLSearchParams();
    if (q) params.set('q', q);
    if (cat) params.set('category', cat);
    window.location.href = window.location.pathname + '?' + params.toString();
}
function clearPressFilters() {
    document.getElementById('press-search').value = '';
    document.getElementById('press-category').value = '';
    window.location.href = window.location.pathname;
}
</script>
{% endblock %}
